<%- include('header', { title: 'Conversation Details - WhatsApp Bot Admin', showLogout: true }) %>

<div class="container">
  <div class="conversation-detail">
    <div class="breadcrumb">
      <a href="/admin/dashboard">‚Üê Back to Dashboard</a>
    </div>

    <div class="conversation-header-detail">
      <div>
        <h2><%= conversation.userName %></h2>
        <p class="phone-number"><%= conversation.phoneNumber %></p>
      </div>
      <div class="conversation-meta-detail">
        <span class="badge badge-<%= conversation.status %>">
          <%= conversation.status %>
        </span>
      </div>
    </div>

    <div class="conversation-stats">
      <div class="stat-item">
        <strong>First Contact:</strong>
        <%= moment(conversation.metadata.firstContactAt).format('MMMM D, YYYY [at] h:mm A') %>
      </div>
      <div class="stat-item">
        <strong>Last Message:</strong>
        <%= moment(conversation.lastMessageAt).fromNow() %>
      </div>
      <div class="stat-item">
        <strong>Total Messages:</strong>
        <%= conversation.metadata.totalMessages %>
      </div>
    </div>

    <div class="messages-container">
      <h3>Chat History</h3>
      <div class="messages">
        <% if (conversation.messages.length === 0) { %>
          <p class="empty-messages">No messages in this conversation.</p>
        <% } else { %>
          <% conversation.messages.forEach(message => { %>
            <div class="message message-<%= message.role %>">
              <div class="message-header">
                <strong><%= message.role === 'user' ? conversation.userName : 'Bot' %></strong>
                <span class="message-time">
                  <%= moment(message.timestamp).format('MMM D, YYYY [at] h:mm A') %>
                </span>
              </div>
              <div class="message-content">
                <%= message.content %>
              </div>
            </div>
          <% }); %>
        <% } %>
      </div>
    </div>

    <div class="conversation-actions-detail">
      <form action="/admin/conversation/<%= conversation._id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this conversation? This action cannot be undone.');">
        <button type="submit" class="btn btn-danger">Delete Conversation</button>
      </form>
    </div>
  </div>
</div>

<%- include('footer') %>
